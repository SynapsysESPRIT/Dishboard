<!--
=========================================================
* Soft UI Design System 3 PRO - v1.2.0
=========================================================

* Product Page:  https://www.creative-tim.com/product/soft-ui-design-system-pro 
* Copyright 2024 Creative Tim (https://www.creative-tim.com)
* Coded by www.creative-tim.com

 =========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. -->
{% load static %}
<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script src="https://raw.githack.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>

    <!-- Open Graph / Facebook -->
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="recipe" />
    <meta property="og:title" content="{{ publication.recette.titre }}" />
    <meta property="og:description" content="{{ publication.recette.description }}" />
    <meta property="og:image" content="{{ publication.recette.image.url }}" />
    <meta property="og:site_name" content="Dishboard Recipes" />
    <meta property="og:cooking_time" content="{{ publication.recette.cook_time }} minutes" />
    <meta property="og:cuisine" content="{{ publication.recette.cuisine }}" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{ publication.recette.titre }}" />
    <meta name="twitter:description" content="{{ publication.recette.description }}" />
    <meta name="twitter:image" content="{{ publication.recette.image.url }}" />
    <meta name="twitter:label1" content="Cooking Time" />
    <meta name="twitter:data1" content="{{ publication.recette.cook_time }} minutes" />
    <meta name="twitter:label2" content="Difficulty" />
    <meta name="twitter:data2" content="{{ publication.recette.difficulty_level }}" />


    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'img/apple-icon.png' %}">
    <link rel="icon" type="image/png" href="{% static 'img/favicon.png' %}">
    <title>
        Dishboard
    </title>
    <!-- Extra details for Live View on GitHub Pages -->
    <!-- Canonical SEO -->
    <link rel="canonical" href="https://www.creative-tim.com/product/soft-ui-design-system-pro" />
    <!--  Social tags      -->
    <meta name="keywords"
        content="bootstrap, bootstrap 5, bootstrap5, ui kit, design system, responsive design, web design ui, ui design system, soft ui kit, soft ui design system">
    <meta name="description"
        content="Most complex and innovative Design System Made by Creative Tim. Check our latest Premium Bootstrap 5 UI Kit.">
    <!-- Twitter Card data -->
    <meta name="twitter:card" content="product">
    <meta name="twitter:site" content="@creativetim">
    <meta name="twitter:title" content="Soft UI Design System 3 Pro by Creative Tim">
    <meta name="twitter:description"
        content="Most complex and innovative Design System Made by Creative Tim. Check our latest Premium Bootstrap 5 UI Kit.">
    <meta name="twitter:creator" content="@creativetim">
    <meta name="twitter:image"
        content="https://s3.amazonaws.com/creativetim_bucket/products/414/thumb/opt_sds_thumbnail.png">
    <!-- Open Graph data -->
    <meta property="fb:app_id" content="655968634437471">
    <meta property="og:title" content="Soft UI Design System 3 Pro by Creative Tim" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://demos.creative-tim.com/soft-ui-design-system-pro/presentation.html" />
    <meta property="og:image"
        content="https://s3.amazonaws.com/creativetim_bucket/products/414/thumb/opt_sds_thumbnail.png" />
    <meta property="og:description"
        content="Most complex and innovative Design System Made by Creative Tim. Check our latest Premium Bootstrap 5 UI Kit." />
    <meta property="og:site_name" content="Creative Tim" />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,800" rel="stylesheet" />
    <!-- Nucleo Icons -->
    <link href="https://demos.creative-tim.com/argon-dashboard-pro/assets/css/nucleo-icons.css" rel="stylesheet" />
    <link href="https://demos.creative-tim.com/argon-dashboard-pro/assets/css/nucleo-svg.css" rel="stylesheet" />
    <!-- Font Awesome Icons -->
    <script type="text/javascript"
        src="/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=pCwUnaeaFAnpcwHyzyb2yPGAazK5RKIsHHQ1KiIG9IoOUsUG-pD2r89e4kG5kGaXFvVV8IMD_xHNlmIEf6qxkSbIVPy-rgg08CPO8gvzpV6xtSuUgSPqWpYEH99aWsOF"
        charset="UTF-8"></script>
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
    <!-- CSS Files -->
    <link id="pagestyle" href="{% static 'css/soft-design-system-pro.min.css' %}" rel="stylesheet" />
    <!-- Anti-flicker snippet (recommended)  -->
    <style>
        .async-hide {
            opacity: 0 !important
        }
    </style>
    <script>
        (function (a, s, y, n, c, h, i, d, e) {
            s.className += ' ' + y;
            h.start = 1 * new Date;
            h.end = i = function () {
                s.className = s.className.replace(RegExp(' ?' + y), '')
            };
            (a[n] = a[n] || []).hide = h;
            setTimeout(function () {
                i();
                h.end = null
            }, c);
            h.timeout = c;
        })(window, document.documentElement, 'async-hide', 'dataLayer', 4000, {
            'GTM-K9BGS8K': true
        });
    </script>
    <!-- Analytics-Optimize Snippet -->
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
        ga('create', 'UA-46172202-22', 'auto', {
            allowLinker: true
        });
        ga('set', 'anonymizeIp', true);
        ga('require', 'GTM-K9BGS8K');
        ga('require', 'displayfeatures');
        ga('require', 'linker');
        ga('linker:autoLink', ["2checkout.com", "avangate.com"]);
    </script>
    <!-- end Analytics-Optimize Snippet -->
    <!-- Google Tag Manager -->
    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start': new Date().getTime(),
                event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src =
                'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-NKDMSK6');
    </script>
    <!-- End Google Tag Manager -->
    <!-- Nepcha Analytics (nepcha.com) -->
    <!-- Nepcha is a easy-to-use web analytics. No cookies and fully compliant with GDPR, CCPA and PECR. -->
    <script defer data-site="demos.creative-tim.com" src="https://api.nepcha.com/js/nepcha-analytics.js"></script>
</head>

<body class="podcast">
    <!-- Extra details for Live View on GitHub Pages -->
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NKDMSK6" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <!-- Navbar Light -->
    {% include 'navbar.html' %}
    <!-- -------- START HEADER 1 w/ text and image on right ------- -->
    </div>
    <header>
        <div class="publication-content">
            <div class="page-header min-vh-75">
                <div class="oblique position-absolute top-0 h-100 d-md-block d-none">
                    <div class="oblique-image bg-cover position-absolute fixed-top ms-auto h-100 z-index-0 border-radius-lg border-top-start-radius-0 ms-n6"
                        style="background-image: url('{% static 'img/podcast/header-image.jpeg' %}')"></div>
                </div>
                <div class="container">
                    <br><br>
                    <div class="text-center mb-5">
                        <h2 class="text-gradient text-warning mb-0 display-4">{{ publication.title }}</h2>
                        <br>
                        <h2 class="mb-4 display-5">{{ publication.recette.titre }}</h2>
                    </div>
                    <br><br>
                    <div class="row align-items-center">
                        <div
                            class="col-lg-6 col-md-7 d-flex justify-content-center text-md-start text-center flex-column animate__animated animate__fadeInLeft">
                            <div class="d-flex align-items-center justify-content-center mb-4">
                                <div class="position-relative d-flex align-items-center hover-zoom">
                                    <i class="ni ni-watch-time text-warning me-2 pulse"></i>
                                    <span class="me-3">{{ publication.created_at|timesince }} ago</span>
                                    <hr class="vertical dark my-1">
                                </div>
                                <div class="position-relative d-flex align-items-center ms-3 hover-zoom">
                                    <i class="ni ni-like-2 text-warning me-2 pulse"></i>
                                    <span class="me-3">12</span>
                                </div>
                                <div class="position-relative d-flex align-items-center hover-zoom">
                                    <i class="ni ni-chat-round text-warning me-2 pulse"></i>
                                    <span class="me-3">{{ comments.count }}</span>
                                </div>
                                <div class="position-relative d-flex align-items-center hover-zoom">
                                    <i class="ni ni-curved-next text-warning me-2 pulse"></i>
                                    <span class="me-3">1</span>
                                </div>
                            </div>

                            <div class="recipe-content-wrapper custom-scrollbar">
                                <div class="recipe-details card shadow-lg p-4 mb-5 animate__animated animate__fadeInUp">
                                    <div class="recipe-description card glass-effect p-4 mb-4 hover-lift">
                                        <h4 class="text-warning text-gradient mb-3">Description</h4>
                                        <div class="description-content">
                                            {{publication.recette.description }}
                                        </div>
                                    </div>

                                    <div class="recipe-ingredients card glass-effect p-4 mb-4 hover-lift">
                                        <h4 class="text-warning text-gradient mb-3">Ingrédients</h4>
                                        <div class="ingredients-content">
                                            {{publication.recette.inventory }}
                                        </div>
                                    </div>

                                    <div class="recipe-info grid-container glass-effect p-4 mb-4 hover-lift">
                                        <div class="info-item">
                                            <i class="fas fa-clock text-warning mb-2"></i>
                                            <p><b class="text-warning">Temps de cuisson:</b><br>{{
                                                publication.recette.cook_time }} minutes</p>
                                        </div>
                                        <div class="info-item">
                                            <i class="fas fa-users text-warning mb-2"></i>
                                            <p><b class="text-warning">Portions:</b><br>{{ publication.recette.servings
                                                }}</p>
                                        </div>
                                        <div class="info-item">
                                            <i class="fas fa-globe text-warning mb-2"></i>
                                            <p><b class="text-warning">Cuisine:</b><br>{{ publication.recette.cuisine }}
                                            </p>
                                        </div>
                                        <div class="info-item">
                                            <i class="fas fa-signal text-warning mb-2"></i>
                                            <p><b
                                                    class="text-warning">Niveau:</b><br>{{publication.recette.difficulty_level }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6 col-md-5">
                            {% if publication.recette.image %}
                            <div class="recipe-image-container h-100 animate__animated animate__fadeInRight">
                                <img src="{{ publication.recette.image.url }}" alt="{{ publication.recette.titre }}"
                                    class="img-fluid w-100 h-100 object-fit-cover rounded-lg shadow-lg hover-scale" />
                            </div>
                            {% else %}
                            <p class="text-muted">Aucune image</p>
                            {% endif %}
                        </div>
                    </div>
                    <br>
                    <div class="row mt-5">
                        <div class="col-12">
                            <div
                                class="recipe-instructions card glass-effect p-4 hover-lift animate__animated animate__fadeInUp">
                                <h4 class="text-warning text-gradient mb-3">Instructions de préparation</h4>
                                <div class="instructions-content">
                                    {{ publication.recette.instructions }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center mt-5 mb-4">
                        <a href="{% url 'export_publication_pdf' publication.id %}" class="btn btn-lg export-btn">
                            <span class="btn-inner--icon">
                                <i class="fas fa-file-pdf fa-bounce me-2"></i>
                            </span>
                            <span class="btn-inner--text">Download Recipe PDF</span>
                        </a>
                    </div>

                    <style>
                        .export-btn {
                            background: linear-gradient(310deg, #2152ff 0%, #21d4fd 100%);
                            color: white;
                            border-radius: 50px;
                            padding: 15px 30px;
                            font-weight: 600;
                            letter-spacing: 0.5px;
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(33, 82, 255, 0.3);
                        }

                        .export-btn:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 8px 20px rgba(33, 82, 255, 0.4);
                            color: white;
                        }

                        .export-btn:active {
                            transform: translateY(1px);
                        }

                        .export-btn i {
                            font-size: 1.2rem;
                        }
                    </style>



                    <script>
                        function downloadPDF() {
                            const element = document.querySelector('.publication-content');

                            // Configure PDF settings
                            const opt = {
                                margin: [10, 10, 10, 10],
                                filename: `publication-${Date.now()}.pdf`,
                                image: { type: 'jpeg', quality: 1 },
                                html2canvas: {
                                    scale: 2,
                                    useCORS: true,
                                    letterRendering: true,
                                    logging: true
                                },
                                jsPDF: {
                                    unit: 'mm',
                                    format: 'a4',
                                    orientation: 'portrait'
                                }
                            };

                            // Show loading indicator
                            Swal.fire({
                                title: 'Creating PDF',
                                html: 'This may take a few seconds...',
                                timerProgressBar: true,
                                didOpen: () => {
                                    Swal.showLoading();
                                }
                            });

                            // Generate and download PDF
                            html2pdf()
                                .set(opt)
                                .from(element)
                                .save()
                                .then(() => {
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'PDF Downloaded Successfully!',
                                        showConfirmButton: false,
                                        timer: 1500
                                    });
                                });
                        }


                    </script>



                    <div class="social-share-section">
                        <div class="share-card glass-effect">
                            <div class="share-header">
                                <i
                                    class="fas fa-share-alt fa-2x text-primary animate__animated animate__pulse animate__infinite"></i>
                                <h4 class="mb-0 ms-3">Share this Publication</h4>
                            </div>

                            <div class="share-buttons">
                                <!-- Facebook -->
                                <button onclick="sharePublication('facebook')" class="share-btn facebook-btn">
                                    <div class="btn-content">
                                        <i class="fab fa-facebook-f"></i>
                                        <span>Facebook</span>
                                    </div>
                                    <span class="share-count">{{ publication.facebook_shares }}</span>
                                </button>

                                <!-- Twitter -->
                                <button onclick="sharePublication('twitter')" class="share-btn twitter-btn">
                                    <div class="btn-content">
                                        <i class="fab fa-twitter"></i>
                                        <span>Twitter</span>
                                    </div>
                                    <span class="share-count">{{ publication.twitter_shares }}</span>
                                </button>

                                <!-- LinkedIn -->
                                <button onclick="sharePublication('linkedin')" class="share-btn linkedin-btn">
                                    <div class="btn-content">
                                        <i class="fab fa-linkedin-in"></i>
                                        <span>LinkedIn</span>
                                    </div>
                                    <span class="share-count">{{ publication.linkedin_shares }}</span>
                                </button>

                                <!-- WhatsApp -->
                                <button onclick="sharePublication('whatsapp')" class="share-btn whatsapp-btn">
                                    <div class="btn-content">
                                        <i class="fab fa-whatsapp"></i>
                                        <span>WhatsApp</span>
                                    </div>
                                    <span class="share-count">{{ publication.whatsapp_shares }}</span>
                                </button>
                            </div>

                            <div class="share-stats">
                                <div class="total-shares-card">
                                    <i class="fas fa-chart-line text-success"></i>
                                    <span class="total-shares">{{ publication.share_count }}</span>
                                    <span class="text-muted">Total Shares</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Rating Section -->
                    <div class="rating-section glass-effect p-4 rounded-4 mb-4">
                        <h5 class="mb-3"><i class="fas fa-star text-warning"></i> Rate this Publication</h5>

                        <div class="stars-container mb-3 d-flex gap-2">
                            {% for i in "12345" %}
                            <i class="fas fa-star fa-2x star-rating cursor-pointer"
                                data-rating="{{ forloop.counter }}"></i>
                            {% endfor %}
                            <span class="ms-2 average-rating">({{ average_rating|default:"0" }})</span>
                        </div>

                        <div class="like-dislike-container mb-3">
                            <button class="btn btn-like {% if user_rating.like %}active{% endif %}"
                                onclick="toggleLike(this)">
                                <i class="fas fa-heart"></i>
                                <span class="like-count">{{ like_count }}</span>
                            </button>
                            <button
                                class="btn btn-outline-danger btn-dislike {% if user_rating and not user_rating.like %}active{% endif %}">
                                <i class="fas fa-thumbs-down"></i>
                            </button>
                        </div>

                        <div class="review-container">
                            <textarea class="form-control rich-editor" rows="3"
                                placeholder="Write your review here..."></textarea>
                            <button class="btn btn-primary mt-3 submit-rating">
                                <i class="fas fa-paper-plane me-2"></i>Submit Rating
                            </button>
                        </div>
                    </div>

                    <div class="reviews-section mt-4">
                        <h5><i class="fas fa-comments"></i> User Reviews</h5>
                        <div class="reviews-container">
                            {% for rating in publication.ratings.all %}
                            <div class="review-card glass-effect p-3 mb-3 rounded-3" data-rating-id="{{ rating.id }}">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="user-name me-3">{{ rating.user.username }}</span>
                                    <div class="stars-display">
                                        {% for i in "12345" %}
                                        <i
                                            class="fas fa-star {% if i|add:'0' <= rating.stars %}text-warning{% endif %}"></i>
                                        {% endfor %}
                                    </div>
                                    <small class="text-muted ms-auto">{{ rating.created_at|timesince }} ago</small>
                                    {% if rating.user == request.user %}
                                    <button class="btn btn-sm btn-danger ms-3 delete-review"
                                        onclick="deleteReview('{{ rating.id }}')">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>

                                    {% endif %}
                                </div>
                                <p class="review-text mb-0">{{ rating.review }}</p>
                            </div>
                            {% endfor %}
                        </div>

                    </div>


                    <style>
                        .btn-like {
                            transition: all 0.3s ease;
                            border-radius: 50px;
                            padding: 8px 20px;
                        }

                        .btn-like.active {
                            background-color: #ff4b4b;
                            color: white;
                            transform: scale(1.05);
                        }

                        .btn-like:hover {
                            transform: scale(1.05);
                        }

                        .btn-like .fa-heart {
                            transition: transform 0.3s ease;
                        }

                        .animate__heartBeat {
                            animation: heartBeat 1.2s ease-in-out;
                        }

                        @keyframes heartBeat {
                            0% {
                                transform: scale(1);
                            }

                            14% {
                                transform: scale(1.3);
                            }

                            28% {
                                transform: scale(1);
                            }

                            42% {
                                transform: scale(1.3);
                            }

                            70% {
                                transform: scale(1);
                            }
                        }

                        .animate__fadeIn {
                            animation: fadeIn 0.3s ease-in;
                        }

                        .animate__fadeOut {
                            animation: fadeOut 0.3s ease-out;
                        }


                        .star-rating {
                            color: #ddd;
                            cursor: pointer;
                            transition: color 0.2s;
                        }

                        .star-rating:hover,
                        .star-rating.active,
                        .star-rating.text-warning {
                            color: #ffc107;
                        }

                        .cursor-pointer {
                            cursor: pointer;
                        }

                        .glass-effect {
                            background: rgba(255, 255, 255, 0.95);
                            backdrop-filter: blur(10px);
                            border: 1px solid rgba(255, 255, 255, 0.18);
                            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
                        }

                        .export-pdf {
                            transition: all 0.3s ease;
                            border-radius: 50px;
                            padding: 10px 25px;
                            background: linear-gradient(145deg, #2196f3, #1976d2);
                            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
                        }

                        .export-pdf:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
                        }
                    </style>

                    <script>



                        function deleteReview(ratingId) {
                            Swal.fire({
                                title: 'Delete Review?',
                                text: "This action cannot be undone",
                                icon: 'warning',
                                showCancelButton: true,
                                confirmButtonColor: '#d33',
                                cancelButtonColor: '#3085d6',
                                confirmButtonText: 'Yes, delete it!'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    fetch(`/Publication/delete-review/${ratingId}/`, {
                                        method: 'POST',
                                        headers: {
                                            'X-CSRFToken': getCookie('csrftoken')
                                        }
                                    })
                                        .then(response => response.json())
                                        .then(data => {
                                            if (data.success) {
                                                document.querySelector(`[data-rating-id="${ratingId}"]`).remove();
                                                Swal.fire(
                                                    'Deleted!',
                                                    'Your review has been deleted.',
                                                    'success'
                                                );
                                            }
                                        });
                                }
                            });
                        }



                        function toggleLike(button) {
                            fetch('/Publication/toggle-like/', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': getCookie('csrftoken')
                                },
                                body: JSON.stringify({
                                    publication_id: "{{ publication.id }}"
                                })
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success) {
                                        // Toggle button state with animation
                                        button.classList.toggle('active');
                                        const heart = button.querySelector('.fa-heart');
                                        heart.classList.add('animate__heartBeat');
                                        setTimeout(() => heart.classList.remove('animate__heartBeat'), 1000);

                                        // Update like count with animation
                                        const likeCount = button.querySelector('.like-count');
                                        likeCount.classList.add('animate__fadeOut');
                                        setTimeout(() => {
                                            likeCount.textContent = data.like_count;
                                            likeCount.classList.remove('animate__fadeOut');
                                            likeCount.classList.add('animate__fadeIn');
                                        }, 300);

                                        // Show toast notification
                                        Swal.fire({
                                            icon: 'success',
                                            title: data.liked ? 'Added to favorites!' : 'Removed from favorites',
                                            showConfirmButton: false,
                                            timer: 1000,
                                            position: 'top-end',
                                            toast: true
                                        });
                                    }
                                });
                        }


                        document.addEventListener('DOMContentLoaded', function () {
                            const stars = document.querySelectorAll('.star-rating');
                            const submitButton = document.querySelector('.submit-rating');
                            let selectedRating = 0;

                            stars.forEach(star => {
                                star.addEventListener('mouseover', function () {
                                    const rating = parseInt(this.dataset.rating);
                                    highlightStars(rating);
                                });

                                star.addEventListener('click', function () {
                                    selectedRating = parseInt(this.dataset.rating);
                                    stars.forEach((s, index) => {
                                        s.classList.toggle('active', index < selectedRating);
                                    });
                                });

                                star.addEventListener('mouseout', function () {
                                    if (!selectedRating) {
                                        clearStars();
                                    } else {
                                        highlightStars(selectedRating);
                                    }
                                });
                            });

                            submitButton.addEventListener('click', submitRating);

                            function highlightStars(count) {
                                stars.forEach((star, index) => {
                                    star.classList.toggle('text-warning', index < count);
                                });
                            }

                            function clearStars() {
                                stars.forEach(star => star.classList.remove('text-warning'));
                            }



                            function submitRating() {
                                if (!selectedRating) {
                                    Swal.fire({
                                        icon: 'warning',
                                        title: 'Please select a rating',
                                        showConfirmButton: false,
                                        timer: 1500
                                    });
                                    return;
                                }

                                const reviewText = document.querySelector('.rich-editor').value;

                                fetch('/Publication/rate/', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'X-CSRFToken': getCookie('csrftoken')
                                    },
                                    body: JSON.stringify({
                                        publication_id: "{{ publication.id }}",
                                        rating: selectedRating,
                                        review: reviewText
                                    })
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.success) {
                                            // Update average rating display
                                            document.querySelector('.average-rating').textContent = `(${data.average_rating})`;

                                            // Update like count
                                            document.querySelector('.like-count').textContent = data.like_count;

                                            // Replace existing review with new one
                                            const reviewsContainer = document.querySelector('.reviews-container');
                                            reviewsContainer.innerHTML = `
                      <div class="review-card glass-effect p-3 mb-3 rounded-3 animate__animated animate__fadeInUp">
                          <div class="d-flex align-items-center mb-2">
                              <span class="user-name me-3">{{ request.user.username }}</span>
                              <div class="stars-display">
                                  ${Array(5).fill().map((_, i) => `
                                      <i class="fas fa-star ${i < selectedRating ? 'text-warning' : ''}"></i>
                                  `).join('')}
                              </div>
                              <small class="text-muted ms-auto">Just now</small>
                          </div>
                          <p class="review-text mb-0">${reviewText}</p>
                      </div>
                  `;

                                            // Clear form and reset stars
                                            document.querySelector('.rich-editor').value = '';
                                            selectedRating = 0;
                                            clearStars();

                                            Swal.fire({
                                                icon: 'success',
                                                title: data.message || 'Rating submitted!',
                                                showConfirmButton: false,
                                                timer: 1500
                                            });
                                        }
                                    });
                            }
                        });
                    </script>








                    <style>
                        .social-share-section {
                            padding: 2rem;
                        }

                        .share-card {
                            background: rgba(255, 255, 255, 0.9);
                            border-radius: 20px;
                            padding: 2rem;
                            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
                            backdrop-filter: blur(4px);
                        }

                        .share-header {
                            display: flex;
                            align-items: center;
                            margin-bottom: 2rem;
                            padding-bottom: 1rem;
                            border-bottom: 2px solid rgba(0, 0, 0, 0.05);
                        }

                        .share-buttons {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                            gap: 1rem;
                            margin-bottom: 2rem;
                        }

                        .share-btn {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 1rem 1.5rem;
                            border: none;
                            border-radius: 12px;
                            color: white;
                            font-weight: 500;
                            transition: all 0.3s ease;
                        }

                        .btn-content {
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        }

                        .share-count {
                            background: rgba(255, 255, 255, 0.2);
                            padding: 0.2rem 0.8rem;
                            border-radius: 20px;
                            font-size: 0.9rem;
                        }

                        .facebook-btn {
                            background: linear-gradient(45deg, #3b5998, #4c70ba);
                        }

                        .twitter-btn {
                            background: linear-gradient(45deg, #1da1f2, #0d8ed9);
                        }

                        .linkedin-btn {
                            background: linear-gradient(45deg, #0077b5, #00a0dc);
                        }

                        .whatsapp-btn {
                            background: linear-gradient(45deg, #25d366, #128C7E);
                        }

                        .share-btn:hover {
                            transform: translateY(-3px);
                            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                        }

                        .share-stats {
                            display: flex;
                            justify-content: center;
                            margin-top: 2rem;
                        }

                        .total-shares-card {
                            background: linear-gradient(135deg, #f6f9fc 0%, #eef2f7 100%);
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            display: flex;
                            align-items: center;
                            gap: 1rem;
                        }

                        .total-shares {
                            font-size: 1.5rem;
                            font-weight: bold;
                            color: #2d3748;
                        }

                        /* Animations */
                        .share-btn:active {
                            transform: scale(0.95);
                        }

                        @keyframes float {
                            0% {
                                transform: translateY(0px);
                            }

                            50% {
                                transform: translateY(-5px);
                            }

                            100% {
                                transform: translateY(0px);
                            }
                        }

                        .share-btn i {
                            animation: float 2s ease-in-out infinite;
                        }
                    </style>


                    <script>
                        function sharePublication(platform) {
                            const publicationId = "{{ publication.id }}";
                            const title = "{{ publication.titre|escapejs }}";
                            const description = "{{ publication.description|truncatewords:30|escapejs }}";
                            const imageUrl = "{{ publication.image.url }}";
                            const currentUrl = window.location.href;

                            // Customize sharing content for each platform
                            const urls = {
                                facebook: `https://www.facebook.com/sharer/sharer.php?u=${currentUrl}&quote=${title} - ${description}`,
                                twitter: `https://twitter.com/intent/tweet?url=${currentUrl}&text=${title}%0A${description}`,
                                linkedin: `https://www.linkedin.com/shareArticle?mini=true&url=${currentUrl}&title=${title}&summary=${description}`,
                                whatsapp: `https://api.whatsapp.com/send?text=${title}%0A${description}%0A${currentUrl}`
                            };

                            // Track share and open sharing dialog
                            fetch(`/Publication/share/${publicationId}/${platform}/`, {
                                method: 'POST',
                                headers: {
                                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                                }
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.status === 'success') {
                                        document.querySelector('.total-shares').textContent = data.total_shares;
                                        window.open(urls[platform], '_blank', 'width=600,height=400');
                                    }
                                });
                        }

                    </script>


                    <br><br><br>
                    <div class="text-center mt-5">
                        <button onclick="toggleChatbot()"
                            class="btn btn-lg btn-warning btn-rounded pulse-button px-5 py-3">
                            <i class="fas fa-podcast me-2"></i>Create your own recipe
                        </button>
                    </div>

                    <div id="chatbot-container" class="container mt-4" style="display: none;">
                        <div class="card glass-effect">
                            <div class="card-header bg-warning bg-gradient">
                                <h5 class="text-white mb-0">
                                    <i class="fas fa-robot me-2"></i>Recipe Assistant
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="chat-messages" class="chat-messages mb-3"
                                    style="height: 300px; overflow-y: auto;">
                                </div>
                                <div class="input-group">
                                    <input type="text" id="user-input" class="form-control"
                                        placeholder="Describe your recipe idea...">
                                    <button onclick="sendMessage()" class="btn btn-warning">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <script>
                        function getRecipe() {
                            const input = document.getElementById('user-input');
                            const output = document.getElementById('recipe-output');
                            const message = input.value;

                            console.log('Sending message:', message);
                            output.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating recipe...';

                            fetch('/api/chatbot/', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': getCookie('csrftoken')
                                },
                                body: JSON.stringify({ message: message })
                            })
                                .then(response => {
                                    console.log('Raw response:', response);
                                    return response.json();
                                })
                                .then(data => {
                                    console.log('Parsed data:', data);
                                    output.innerHTML = data.response;
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                    output.innerHTML = 'Error generating recipe. Check console for details.';
                                });
                        }

                    </script>

                    <script>
                        function toggleChatbot() {
                            const container = document.getElementById('chatbot-container');
                            container.style.display = container.style.display === 'none' ? 'block' : 'none';
                        }

                        function sendMessage() {
                            const input = document.getElementById('user-input');
                            const message = input.value;
                            if (!message) return;

                            addMessage('user', message);
                            input.value = '';

                            const loadingMessage = addMessage('bot', '<i class="fas fa-spinner fa-spin"></i> Creating your recipe...');

                            fetch('/Publication/api/chatbot/', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': getCookie('csrftoken')
                                },
                                body: JSON.stringify({ message: message })
                            })
                                .then(response => response.json())
                                .then(data => {
                                    loadingMessage.remove();
                                    if (data.status === 'success') {
                                        addMessage('bot', data.response);
                                    } else {
                                        console.log('API Response:', data);
                                        addMessage('bot', data.response || 'Error creating recipe. Please try again.');
                                    }
                                });
                        }

                        function addMessage(sender, text) {
                            const messages = document.getElementById('chat-messages');
                            const messageDiv = document.createElement('div');
                            messageDiv.className = `chat-message ${sender} mb-2 p-2 ${sender === 'user' ? 'text-end' : ''}`;
                            messageDiv.innerHTML = `
        <span class="message-bubble ${sender === 'user' ? 'bg-warning' : 'bg-light'} rounded p-2 d-inline-block">
            ${text}
        </span>
    `;
                            messages.appendChild(messageDiv);
                            messages.scrollTop = messages.scrollHeight;
                            return messageDiv;
                        }

                    </script>

                    <style>
                        .chat-message.user .message-bubble {
                            background: linear-gradient(310deg, #fb6340 0%, #fbb140 100%);
                            color: white;
                            max-width: 70%;
                        }

                        .chat-message.bot .message-bubble {
                            background: #f8f9fa;
                            max-width: 70%;
                        }

                        .glass-effect {
                            backdrop-filter: blur(10px);
                            background: rgba(255, 255, 255, 0.9);
                        }
                    </style>

                </div>
            </div>
            <br><br><br>
            <style>
                .custom-scrollbar {
                    scrollbar-width: thin;
                    scrollbar-color: #ffa500 #f5f5f5;
                }

                .custom-scrollbar::-webkit-scrollbar {
                    width: 8px;
                }

                .custom-scrollbar::-webkit-scrollbar-track {
                    background: #f5f5f5;
                    border-radius: 10px;
                }

                .custom-scrollbar::-webkit-scrollbar-thumb {
                    background: #ffa500;
                    border-radius: 10px;
                    border: 2px solid #f5f5f5;
                }

                .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                    background: #ff8c00;
                }

                .hover-zoom:hover {
                    transform: scale(1.1);
                    transition: transform 0.3s ease;
                }

                .hover-scale:hover {
                    transform: scale(1.05);
                    transition: transform 0.3s ease;
                }

                .pulse {
                    animation: pulse 2s infinite;
                }

                .glass-effect {
                    background: rgba(255, 255, 255, 0.95);
                    backdrop-filter: blur(10px);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    border-radius: 15px;
                }

                .hover-lift {
                    transition: transform 0.3s ease, box-shadow 0.3s ease;
                }

                .hover-lift:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
                }

                .info-item {
                    text-align: center;
                    padding: 15px;
                }

                .info-item i {
                    font-size: 24px;
                }

                .grid-container {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 1rem;
                }

                .recipe-content-wrapper {
                    max-height: 80vh;
                    overflow-y: auto;
                    padding-right: 15px;
                }

                .recipe-image-container {
                    height: 100%;
                    overflow: hidden;
                    border-radius: 15px;
                }

                .object-fit-cover {
                    object-fit: cover;
                }

                .pulse-button {
                    animation: pulse 1.5s infinite;
                    font-size: 1.25rem;
                }

                @keyframes pulse {
                    0% {
                        transform: scale(1);
                    }

                    50% {
                        transform: scale(1.05);
                    }

                    100% {
                        transform: scale(1);
                    }
                }
            </style>
    </header>
    <!-- -------- END HEADER 1 w/ text and image on right ------- -->
    <!-- -------- START CONTENT 13 w/ audio and author ------- -->
    <section class="pt-md-8 pb-5 position-relative bg-gradient-light"
        style="background-image: url('https://raw.githubusercontent.com/creativetimofficial/public-assets/master/soft-ui-design-system/assets/img/minimal-interior.jpg'); background-size: cover; background-position: center; background-blend-mode: overlay;">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-5 mx-auto">
                    <div class="author-card glass-card p-4 border-radius-lg shadow-lg hover-lift"
                        style="background-color: rgba(255, 255, 255, 0.9);">
                        <div class="d-flex flex-column align-items-center">
                            <div class="author-image position-relative mb-3">
                                <img src="{% static 'img/team-3.jpg' %}" alt="..."
                                    class="avatar avatar-xxl rounded-circle shadow-lg border border-3 border-white">
                                <div class="online-status bg-success rounded-circle position-absolute bottom-0 end-0">
                                </div>
                            </div>
                            <div class="text-center">
                                <h5 class="text-dark font-weight-bold mb-1">John Mannes</h5>
                                <p class="text-gradient text-primary mb-2">Creative Tim Author</p>
                                <div class="d-flex justify-content-center align-items-center gap-2">
                                    <button class="btn btn-sm btn-primary rounded-pill hover-scale">Follow</button>
                                    <button class="btn btn-sm btn-outline-primary rounded-pill hover-scale">
                                        <i class="fas fa-heart"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <br><br><br>
        <div class="position-absolute top-0 start-0 w-100 h-100 bg-pattern opacity-10"></div>
    </section> <!-- -------- END CONTENT 13 w/ audio and author ------- -->
    <!-- -------- START CONTENT 14 w/ image cards and sticky content ------- -->
    <section class="py-6 bg-gray-100">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <h3 class="mb-4 text-warning text-gradient">Latest Publications</h3>
                    <br>
                </div>
                <br><br>
                {% for latest_pub in latest_publications|slice:":3" %}
                <div class="col-lg-12 mb-4">
                    <div class="card hover-elevate">
                        <div class="row g-0">
                            <div class="col-sm-3 col-3">
                                <div class="position-relative h-100">
                                    <img class="img-fluid rounded-start w-100 object-fit-cover"
                                        src="{{ latest_pub.recette.image.url }}" alt="{{ latest_pub.title }}"
                                        style="height: 120px;">
                                    <div class="position-absolute top-0 end-0 p-2">
                                        <span class="badge bg-primary">{{ latest_pub.recette.cuisine }}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-9 col-8">
                                <div class="card-body">
                                    <h5 class="card-title mb-2">
                                        <a href="{% url 'publication_detail' latest_pub.id %}"
                                            class="text-dark font-weight-bold hover-text-primary">{{ latest_pub.title
                                            }}</a>
                                    </h5>
                                    <p class="card-text text-muted mb-2">{{
                                        latest_pub.recette.description|truncatewords:25 }}</p>
                                    <div class="d-flex align-items-center">
                                        <div class="me-4">
                                            <i class="fas fa-clock text-primary"></i>
                                            <span class="ms-1">{{ latest_pub.created_at|timesince }} ago</span>
                                        </div>
                                        <div class="me-4">
                                            <i class="fas fa-utensils text-primary"></i>
                                            <span class="ms-1">{{ latest_pub.recette.cook_time }} mins</span>
                                        </div>
                                        <div>
                                            <i class="fas fa-signal text-primary"></i>
                                            <span class="ms-1">{{ latest_pub.recette.difficulty_level }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <style>
        .hover-elevate {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .hover-elevate:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .hover-text-primary:hover {
            color: #5e72e4 !important;
            text-decoration: none;
        }

        .object-fit-cover {
            object-fit: cover;
            height: 200px;
        }

        .badge {
            font-size: 0.8rem;
            padding: 0.5em 1em;
        }
    </style>


    <!-- -------- END CONTENT 14 w/ image cards and sticky content ------- -->
    <section class="py-7 bg-gradient-light">
        <div class="container">
            <div class="row">
                <div class="col-md-8 ms-auto me-auto">
                    <div class="card shadow-xl border-0 rounded-4 p-4 bg-white backdrop-blur-sm">
                        <h4 class="text-center mb-5 gradient-text animate__animated animate__fadeIn">
                            <i class="fas fa-comments me-2"></i>Community Discussions
                        </h4>
                        {% if comments %}
                        {% for comment in comments %}
                        <div class="comment-card mb-4 hover-elevate p-4 rounded-4 animate__animated animate__fadeInUp">
                            <div class="d-flex">
                                <div>
                                    <a href="javascript:;">
                                        <div class="position-relative">
                                            <div class="avatar-wrapper">
                                                <img class="avatar rounded-circle border-3 border-primary shadow-sm"
                                                    src="{% static 'img/team-4.jpg' %}" alt="...">
                                                <div class="online-indicator pulse"></div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                <div class="ms-3 flex-grow-1">
                                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                                        <h6 class="mb-0">
                                            <span class="fw-bold text-gradient animate__animated animate__pulse">{{
                                                comment.title }}</span>
                                            <span class="text-muted text-xs fst-italic">. {{ comment.created_at }}
                                            </span>
                                        </h6>
                                        <div class="comment-actions btn-group-hover">
                                            <a href="javascript:;"
                                                class="btn btn-soft-primary btn-sm rounded-pill reply-btn hover-scale"
                                                data-comment-id="{{ comment.id }}">
                                                <i class="fa fa-reply me-1 fa-bounce"></i> Reply
                                            </a>
                                            <a href="javascript:;"
                                                class="btn btn-soft-secondary btn-sm rounded-pill modify-btn hover-scale"
                                                data-comment-id="{{ comment.id }}">
                                                <i class="fas fa-edit me-1 fa-bounce"></i> Modify
                                            </a>
                                            <a href="{% url 'delete_comment' comment.id %}"
                                                class="btn btn-soft-danger btn-sm rounded-pill hover-scale">
                                                <i class="fas fa-trash me-1 fa-bounce"></i> Delete
                                            </a>
                                            <a href="javascript:;"
                                                class="btn btn-soft-danger btn-sm rounded-pill like-btn hover-scale">
                                                <i class="fas fa-heart me-1 fa-beat"></i> <span
                                                    class="like-count">25</span>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="comment-content mt-3 text-muted glass-effect p-3 rounded-3"
                                        style="max-width: 800px;">
                                        {{ comment.contenu }}
                                    </div>
                                </div>
                            </div>

                            <!-- Reply form -->
                            <div class="reply-form-container-{{ comment.id }} fade-slide" style="display: none;">
                                <div class="d-flex mt-3">
                                    <div class="ms-5 w-100">
                                        <form method="POST" class="reply-form floating-form glass-effect p-3 rounded-4"
                                            data-parent-id="{{ comment.id }}">
                                            {% csrf_token %}
                                            <input type="hidden" name="parent_comment" value="{{ comment.id }}">
                                            <div class="form-group mb-3">
                                                <textarea name="reply_content"
                                                    class="form-control bg-white border-0 shadow-sm" rows="3"
                                                    placeholder="Share your thoughts..."></textarea>
                                            </div>
                                            <div class="text-end">
                                                <button type="button"
                                                    class="btn btn-soft-secondary btn-sm rounded-pill cancel-reply me-2 hover-scale">
                                                    <i class="fas fa-times me-1"></i> Cancel
                                                </button>
                                                <button type="submit"
                                                    class="btn btn-primary btn-sm rounded-pill hover-scale">
                                                    <i class="fas fa-paper-plane me-1 fa-fade"></i> Send Reply
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Edit form -->
                            <div class="edit-form-container-{{ comment.id }} fade-slide" style="display: none;">
                                <div class="d-flex mt-3">
                                    <div class="ms-5 w-100">
                                        <form method="POST"
                                            action="{% url 'update_comment' publication.id comment.id %}"
                                            class="edit-form floating-form glass-effect p-3 rounded-4"
                                            data-comment-id="{{ comment.id }}">
                                            {% csrf_token %}
                                            <div class="form-group mb-3">
                                                <textarea name="contenu"
                                                    class="form-control bg-white border-0 shadow-sm"
                                                    rows="3">{{ comment.contenu }}</textarea>
                                            </div>
                                            <div class="text-end">
                                                <button type="button"
                                                    class="btn btn-soft-secondary btn-sm rounded-pill cancel-edit me-2 hover-scale">
                                                    <i class="fas fa-times me-1"></i> Cancel
                                                </button>
                                                <button type="submit"
                                                    class="btn btn-warning btn-sm rounded-pill hover-scale">
                                                    <i class="fas fa-save me-1 fa-fade"></i> Save Changes
                                                </button>
                                            </div>
                                        </form>


                                        <script>
                                            document.querySelectorAll('.edit-form').forEach(form => {
                                                form.addEventListener('submit', function (e) {
                                                    e.preventDefault();
                                                    const commentId = this.dataset.commentId;
                                                    const content = this.querySelector('textarea[name="contenu"]').value;

                                                    fetch(`/comment/update/${commentId}/`, {
                                                        method: 'POST',
                                                        headers: {
                                                            'Content-Type': 'application/x-www-form-urlencoded',
                                                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                                                        },
                                                        body: `contenu=${encodeURIComponent(content)}`
                                                    })
                                                        .then(response => {
                                                            if (response.ok) {
                                                                window.location.reload();
                                                            }
                                                        });
                                                });
                                            });
                                        </script>

                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="text-center empty-state p-5 animate__animated animate__fadeIn">
                            <i class="fas fa-comments fa-4x text-primary mb-3 animate__animated animate__bounce"></i>
                            <p class="lead text-gradient">Be the first to start the conversation!</p>
                            <div class="mt-3">
                                <button class="btn btn-primary rounded-pill hover-scale">
                                    <i class="fas fa-plus me-2"></i>Start Discussion
                                </button>
                            </div>
                        </div>
                        {% endif %}

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                // Handle modify button click
                                document.querySelectorAll('.modify-btn').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const commentId = this.getAttribute('data-comment-id');
                                        const editForm = document.querySelector(`.edit-form-container-${commentId}`);
                                        editForm.style.display = 'block';
                                    });
                                });

                                // Handle cancel edit button click
                                document.querySelectorAll('.cancel-edit').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const editForm = this.closest('[class^="edit-form-container-"]');
                                        editForm.style.display = 'none';
                                    });
                                });

                                // Handle edit form submission
                                document.querySelectorAll('.edit-form').forEach(form => {
                                    form.addEventListener('submit', function (e) {
                                        e.preventDefault();
                                        const commentId = this.getAttribute('data-comment-id');
                                        const content = this.querySelector('textarea[name="edit_content"]').value;

                                        // Create a new form for submission
                                        const submitForm = document.createElement('form');
                                        submitForm.method = 'POST';
                                        submitForm.action = `/Publication/${commentId}/?next=/Publication/`;  // Added next parameter

                                        // Add CSRF token
                                        const csrfInput = document.createElement('input');
                                        csrfInput.type = 'hidden';
                                        csrfInput.name = 'csrfmiddlewaretoken';
                                        csrfInput.value = this.querySelector('[name=csrfmiddlewaretoken]').value;
                                        submitForm.appendChild(csrfInput);

                                        // Add content
                                        const contentInput = document.createElement('input');
                                        contentInput.type = 'hidden';
                                        contentInput.name = 'contenu';
                                        contentInput.value = content;
                                        submitForm.appendChild(contentInput);

                                        // Submit the form
                                        document.body.appendChild(submitForm);
                                        submitForm.submit();
                                    });
                                });
                            });
                        </script>






                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-8 ms-auto me-auto">
                    <div class="card shadow-lg border-0 rounded-4 p-4 mt-5 glass-effect hover-scale">
                        <div class="text-center mb-4">
                            <h4 class="gradient-text fw-bold animate__animated animate__fadeIn">
                                <i class="fas fa-feather-alt me-2 fa-bounce"></i>Share Your Thoughts
                            </h4>
                            <p class="text-muted small animate__animated animate__fadeIn animate__delay-1s">Your voice
                                matters. Let's make this conversation meaningful.</p>
                        </div>
                        <div class="d-flex animate__animated animate__fadeInUp animate__delay-1s">
                            <div>
                                <div class="position-relative">
                                    <div class="avatar-wrapper pulse">
                                        <img class="avatar rounded-circle border-3 border-primary" alt="64x64"
                                            src="{% static 'img/team-2.jpg' %}"
                                            style="width: 50px; height: 50px; object-fit: cover;">
                                        <div class="online-indicator position-absolute bg-success rounded-circle"
                                            style="width: 12px; height: 12px; bottom: 2px; right: 2px; border: 2px solid white;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="ms-3 w-100">
                                <form method="POST" class="comment-form floating-form">
                                    {% csrf_token %}
                                    {% for field in comment_form %}
                                    <div class="form-group floating-label mb-3">
                                        {{ field.label_tag }}
                                        <input type="{{ field.field.widget.input_type }}" name="{{ field.name }}"
                                            class="form-control bg-white backdrop-blur-sm border-0 shadow-sm" {% if
                                            field.value %}value="{{ field.value }}" {% endif %}
                                            placeholder="Express yourself...">
                                        <div class="focus-border"></div>
                                    </div>
                                    {% endfor %}
                                    <div class="text-end btn-group-hover">
                                        <button type="reset"
                                            class="btn btn-soft-secondary rounded-pill me-2 hover-scale">
                                            <i class="fas fa-undo me-1"></i> Clear
                                        </button>
                                        <button type="submit" class="btn btn-lg btn-primary rounded-pill hover-scale">
                                            <i class="fas fa-paper-plane me-2 fa-fade"></i> Post Comment
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <style>
        .bg-gradient-light {
            background: linear-gradient(145deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .backdrop-blur-sm {
            backdrop-filter: blur(8px);
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .hover-scale {
            transition: transform 0.2s ease;
        }

        .hover-scale:hover {
            transform: scale(1.05);
        }

        .btn-group-hover .btn {
            opacity: 0.8;
            transition: all 0.3s ease;
        }

        .btn-group-hover:hover .btn {
            opacity: 1;
        }

        .pulse {
            animation: pulse-animation 2s infinite;
        }

        @keyframes pulse-animation {
            0% {
                box-shadow: 0 0 0 0 rgba(45, 206, 137, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(45, 206, 137, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(45, 206, 137, 0);
            }
        }

        .shadow-xl {
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .animate__animated {
            animation-duration: 0.8s;
        }

        .fa-bounce {
            animation: bounce 1s infinite;
        }

        .fa-beat {
            animation: beat 1s infinite;
        }

        .fa-fade {
            animation: fade 2s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-3px);
            }
        }

        @keyframes beat {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }
        }

        @keyframes fade {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }
    </style>


    <style>
        .gradient-text {
            background: linear-gradient(45deg, #5e72e4, #825ee4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        .comment-card {
            background: white;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .comment-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .avatar-wrapper {
            position: relative;
            display: inline-block;
        }

        .online-indicator {
            width: 12px;
            height: 12px;
            background-color: #2dce89;
            border-radius: 50%;
            position: absolute;
            bottom: 0;
            right: 0;
            border: 2px solid white;
        }

        .btn-soft-primary {
            background-color: rgba(94, 114, 228, 0.1);
            color: #5e72e4;
        }

        .btn-soft-danger {
            background-color: rgba(245, 54, 92, 0.1);
            color: #f5365c;
        }

        .btn-soft-secondary {
            background-color: rgba(130, 130, 130, 0.1);
            color: #828282;
        }

        .floating-form .form-control {
            border-radius: 15px;
            padding: 15px 20px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .floating-form .form-control:focus {
            border-color: #5e72e4;
            box-shadow: 0 0 0 0.2rem rgba(94, 114, 228, 0.15);
            transform: translateY(-2px);
        }

        .hover-scale {
            transition: transform 0.3s ease;
        }

        .hover-scale:hover {
            transform: scale(1.05);
        }

        .fade-slide {
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(-10px);
        }

        .fade-slide[style*="display: block"] {
            opacity: 1;
            transform: translateY(0);
        }

        .empty-state {
            color: #8898aa;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .like-btn:hover {
            animation: pulse 1s infinite;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Handle reply button clicks with smooth animation
            document.querySelectorAll('.reply-btn').forEach(button => {
                button.addEventListener('click', function (e) {
                    e.preventDefault();
                    const commentId = this.getAttribute('data-comment-id');
                    const replyContainer = document.querySelector(`.reply-form-container-${commentId}`);
                    replyContainer.style.display = 'block';
                    setTimeout(() => replyContainer.classList.add('show'), 10);
                });
            });

            // Handle cancel reply button clicks with smooth animation
            document.querySelectorAll('.cancel-reply').forEach(button => {
                button.addEventListener('click', function () {
                    const replyForm = this.closest('.reply-form-container-' + this.closest('form').getAttribute('data-parent-id'));
                    replyForm.classList.remove('show');
                    setTimeout(() => replyForm.style.display = 'none', 300);
                });
            });

            // Like button functionality
            document.querySelectorAll('.like-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const likeCount = this.querySelector('.like-count');
                    let count = parseInt(likeCount.textContent);
                    if (this.classList.contains('liked')) {
                        this.classList.remove('liked');
                        likeCount.textContent = count - 1;
                    } else {
                        this.classList.add('liked');
                        likeCount.textContent = count + 1;
                    }
                });
            });
        });
    </script>

    <section class="py-6 bg-gray-100">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h3 class="text-warning text-gradient mb-4">Latest Publications</h3>
                </div>
                {% for latest_pub in latest_publications|slice:":4" %}
                <div class="col-lg-3 mb-lg-0 mb-4">
                    <div class="card">
                        <div class="card-header p-0 mx-3 mt-3 position-relative z-index-1">
                            <a href="{% url 'publication_detail' latest_pub.id %}" class="d-block">
                                <img src="{{ latest_pub.recette.image.url }}" class="img-fluid border-radius-lg">
                                <span
                                    class="mask bg-gradient-dark position-absolute top-0 start-0 border-radius-lg"></span>
                                <button
                                    class="btn btn-white btn-icon-only btn-rounded z-index-2 position-absolute end-5 top-7"
                                    data-bs-toggle="tooltip" data-bs-placement="top" title="Add to favorites">
                                    <i class="ni ni-favourite-28"></i>
                                </button>
                            </a>
                        </div>
                        <div class="card-body pt-3">
                            <a href="{% url 'publication_detail' latest_pub.id %}"
                                class="card-title h5 d-block text-darker">
                                {{ latest_pub.title }}
                            </a>
                            <p class="card-description mb-4">
                                {{ latest_pub.recette.description|truncatewords:20 }}
                            </p>
                            <div class="author align-items-center">
                                <img src="{% static 'img/team-2.jpg' %}" alt="..." class="avatar shadow">
                                <div class="name ps-3">
                                    <span>{{ latest_pub.recette.titre }}</span>
                                    <div class="stats">
                                        <small>Posted {{ latest_pub.created_at|timesince }} ago</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <footer class="footer pt-5 mt-5">
        <hr class="horizontal dark mb-5">
        <div class="container">
            <div class=" row">
                <div class="col-md-3 mb-4 ms-auto">
                    <div>
                        <h6 class="text-gradient text-primary font-weight-bolder">Soft UI Design System 3 PRO</h6>
                    </div>
                    <div>
                        <h6 class="mt-3 mb-2 opacity-8">Social</h6>
                        <ul class="d-flex flex-row ms-n3 nav">
                            <li class="nav-item">
                                <a class="nav-link pe-1" href="https://www.facebook.com/CreativeTim/" target="_blank">
                                    <i class="fab fa-facebook text-lg opacity-8"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link pe-1" href="https://twitter.com/creativetim" target="_blank">
                                    <i class="fab fa-twitter text-lg opacity-8"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link pe-1" href="https://dribbble.com/creativetim" target="_blank">
                                    <i class="fab fa-dribbble text-lg opacity-8"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link pe-1" href="https://github.com/creativetimofficial" target="_blank">
                                    <i class="fab fa-github text-lg opacity-8"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link pe-1" href="https://www.youtube.com/channel/UCVyTG4sCw-rOvB9oHkzZD1w"
                                    target="_blank">
                                    <i class="fab fa-youtube text-lg opacity-8"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-2 col-sm-6 col-6 mb-4">
                    <div>
                        <h6 class="text-gradient text-primary text-sm">Company</h6>
                        <ul class="flex-column ms-n3 nav">
                            <li class="nav-item">
                                <a class="nav-link" href="https://www.creative-tim.com/presentation" target="_blank">
                                    About Us
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://www.creative-tim.com/templates/free" target="_blank">
                                    Freebies
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://www.creative-tim.com/templates/premium"
                                    target="_blank">
                                    Premium Tools
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://www.creative-tim.com/blog" target="_blank">
                                    Blog
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-2 col-sm-6 col-6 mb-4">
                    <div>
                        <h6 class="text-gradient text-primary text-sm">Resources</h6>
                        <ul class="flex-column ms-n3 nav">
                            <li class="nav-item">
                                <a class="nav-link" href="https://iradesign.io/" target="_blank">
                                    Illustrations
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://www.creative-tim.com/bits" target="_blank">
                                    Bits & Snippets
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://www.creative-tim.com/affiliates/new" target="_blank">
                                    Affiliate Program
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-2 col-sm-6 col-6 mb-4">
                    <div>
                        <h6 class="text-gradient text-primary text-sm">Help & Support</h6>
                        <ul class="flex-column ms-n3 nav">
                            <li class="nav-item">
                                <a class="nav-link" href="https://www.creative-tim.com/contact-us" target="_blank">
                                    Contact Us
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://www.creative-tim.com/knowledge-center"
                                    target="_blank">
                                    Knowledge Center
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://services.creative-tim.com/?ref=ct-soft-ui-footer"
                                    target="_blank">
                                    Custom Development
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://www.creative-tim.com/sponsorships" target="_blank">
                                    Sponsorships
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-2 col-sm-6 col-6 mb-4 me-auto">
                    <div>
                        <h6 class="text-gradient text-primary text-sm">Legal</h6>
                        <ul class="flex-column ms-n3 nav">
                            <li class="nav-item">
                                <a class="nav-link" href="https://www.creative-tim.com/terms" target="_blank">
                                    Terms &amp; Conditions
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://www.creative-tim.com/privacy" target="_blank">
                                    Privacy Policy
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://www.creative-tim.com/license" target="_blank">
                                    Licenses (EULA)
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-12">
                    <div class="text-center">

                    </div>
                </div>
            </div>
        </div>
        <div class="notification-center">
            <div class="notification-bell" id="notificationBell">
                <i class="fas fa-bell fa-bounce"></i>
                <span class="notification-badge pulse">0</span>
            </div>

            <div class="notification-panel glass-effect" id="notificationPanel">
                <div class="notification-header">
                    <h5><i class="fas fa-bell-plus"></i> Notifications</h5>
                    <div class="notification-actions">
                        <button class="mark-all-read">
                            <i class="fas fa-check-double"></i> Mark all read
                        </button>
                        <button class="clear-all-btn" id="clearAllBtn">
                            <i class="fas fa-trash"></i> Clear All
                        </button>

                    </div>
                </div>

                <div class="notification-list custom-scrollbar" id="notificationList">
                    <!-- Notifications will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <style>
            .notification-center {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
            }

            .notification-bell {
                position: relative;
                cursor: pointer;
                background: linear-gradient(145deg, #ffffff, #e6e6e6);
                padding: 15px;
                border-radius: 50%;
                box-shadow: 5px 5px 15px #d1d1d1, -5px -5px 15px #ffffff;
                transition: transform 0.3s ease;
            }

            .notification-bell:hover {
                transform: scale(1.1);
            }

            .notification-badge {
                position: absolute;
                top: -5px;
                right: -5px;
                background: linear-gradient(45deg, #ff416c, #ff4b2b);
                color: white;
                border-radius: 50%;
                padding: 5px 8px;
                font-size: 12px;
                box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16);
            }

            .pulse {
                animation: pulse 2s infinite;
            }

            .glass-effect {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.18);
                box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            }

            .notification-panel {
                display: none;
                position: absolute;
                top: 70px;
                right: 0;
                width: 380px;
                border-radius: 15px;
                overflow: hidden;
            }

            .notification-header {
                padding: 20px;
                background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
                color: white;
            }

            .notification-actions {
                display: flex;
                gap: 10px;
                margin-top: 10px;
            }

            .notification-actions button {
                background: rgba(255, 255, 255, 0.2);
                border: none;
                padding: 5px 10px;
                border-radius: 20px;
                color: white;
                font-size: 12px;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .notification-actions button:hover {
                background: rgba(255, 255, 255, 0.3);
                transform: scale(1.05);
            }

            .notification-list {
                max-height: 400px;
                overflow-y: auto;
                padding: 15px;
            }

            .notification-item {
                padding: 15px;
                margin-bottom: 10px;
                border-radius: 10px;
                background: linear-gradient(145deg, #ffffff, #f5f5f5);
                box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
                transform: translateX(100%);
                animation: slideIn 0.5s forwards;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .notification-item:hover {
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }

            .notification-item.unread {
                border-left: 4px solid #4facfe;
            }

            .custom-scrollbar::-webkit-scrollbar {
                width: 6px;
            }

            .custom-scrollbar::-webkit-scrollbar-track {
                background: rgba(0, 0, 0, 0.05);
            }

            .custom-scrollbar::-webkit-scrollbar-thumb {
                background: linear-gradient(45deg, #4facfe, #00f2fe);
                border-radius: 3px;
            }

            @keyframes slideIn {
                to {
                    transform: translateX(0);
                }
            }

            @keyframes pulse {
                0% {
                    box-shadow: 0 0 0 0 rgba(66, 133, 244, 0.4);
                }

                70% {
                    box-shadow: 0 0 0 10px rgba(66, 133, 244, 0);
                }

                100% {
                    box-shadow: 0 0 0 0 rgba(66, 133, 244, 0);
                }
            }
        </style>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const bell = document.getElementById('notificationBell');
                const panel = document.getElementById('notificationPanel');
                const notificationList = document.getElementById('notificationList');
                let notificationCount = 0;

                bell.addEventListener('click', () => {
                    panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
                });

                function addNotification(message, type = 'info') {
                    const notification = document.createElement('div');
                    notification.className = 'notification-item unread animate__animated animate__fadeInRight';
                    notification.innerHTML = `
            <div class="notification-content">
                <strong>${message}</strong>
                <small>
                    <i class="far fa-clock"></i> Just now
                </small>
            </div>
        `;
                    notificationList.prepend(notification);

                    notificationCount++;
                    document.querySelector('.notification-badge').textContent = notificationCount;

                    // Show toast notification
                    Swal.fire({
                        toast: true,
                        position: 'top-end',
                        icon: type,
                        title: message,
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                            toast.addEventListener('mouseenter', Swal.stopTimer)
                            toast.addEventListener('mouseleave', Swal.resumeTimer)
                        }
                    });
                }

                // Process Django messages
                {% if messages %}
                {% for message in messages %}
                addNotification("{{ message }}", "{{ message.tags }}");
                {% endfor %}
                {% endif %}


                document.getElementById('clearAllBtn').addEventListener('click', () => {
                    const notificationItems = document.querySelectorAll('.notification-item');
                    notificationItems.forEach(item => {
                        item.classList.add('animate__fadeOutRight');
                        setTimeout(() => {
                            item.remove();
                        }, 500);
                    });
                    notificationCount = 0;
                    document.querySelector('.notification-badge').textContent = '0';
                });


                // Clear all notifications
                // Clear all notifications
                /*document.querySelector('.clear-all').addEventListener('click', () => {
                    const notificationItems = document.querySelectorAll('.notification-item');
                    notificationItems.forEach(item => {
                        item.classList.add('animate__fadeOutRight');
                        setTimeout(() => {
                            item.remove();
                        }, 500);
                    });
                    notificationCount = 0;
                    document.querySelector('.notification-badge').textContent = '0';
                });*/


                // Mark all as read
                document.querySelector('.mark-all-read').addEventListener('click', () => {
                    document.querySelectorAll('.notification-item').forEach(item => {
                        item.classList.remove('unread');
                    });
                });
            });

        </script>



    </footer>
    <!--   Core JS Files   -->
    <script src="{% static 'js/core/popper.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/core/bootstrap.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/plugins/perfect-scrollbar.min.js' %}"></script>
    <!--  Plugin for TypedJS, full documentation here: https://github.com/mattboldt/typed.js/ -->
    <script src="{% static 'js/plugins/typedjs.js' %}"></script>
    <script src="{% static 'js/plugins/green-audio-player.min.js' %}"></script>
    <!--  Plugin for Parallax, full documentation here: https://github.com/wagerfield/parallax  -->
    <script src="{% static 'js/plugins/parallax.min.js' %}"></script>
    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="{% static 'js/plugins/nouislider.min.js' %}" type="text/javascript"></script>
    <!--  Plugin for the GlideJS Carousel, full documentation here: http://kenwheeler.github.io/slick/ -->
    <script src="{% static 'js/plugins/glidejs.min.js' %}" type="text/javascript"></script>
    <!--  Plugin for the blob animation -->
    <script src="{% static 'js/plugins/anime.min.js' %}" type="text/javascript"></script>
    <!-- Chart JS -->
    <script src="{% static 'js/plugins/chartjs.min.js' %}"></script>
    <!-- Control Center for Soft UI Kit: parallax effects, scripts for the example pages etc -->
    <!--  Google Maps Plugin    -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDTTfWur0PDbZWPr7Pmq8K3jiDp0_xUziI"></script>
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script src="{% static 'js/soft-design-system-pro.min.js' %}"></script>
    <script>
    </script>
    <script type="text/javascript">
        new GreenAudioPlayer('.gap-example');
    </script>
    <script defer
        src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015"
        integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ=="
        data-cf-beacon='{"rayId":"8e10ec0c3d617787","serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2024.10.5","token":"1b7cbb72744b40c580f8633c6b62637e"}'
        crossorigin="anonymous"></script>
    <script>
        document.querySelectorAll('.edit-form').forEach(form => {
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                const commentId = this.dataset.commentId;
                const content = this.querySelector('textarea[name="contenu"]').value;

                fetch(`/comment/update/${commentId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    },
                    body: `contenu=${encodeURIComponent(content)}`
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            // Update the comment content in the DOM
                            const commentContent = document.querySelector(`#comment-content-${commentId}`);
                            commentContent.textContent = data.content;

                            // Hide the edit form
                            const editForm = document.querySelector(`.edit-form-container-${commentId}`);
                            editForm.style.display = 'none';
                        }
                    });
            });
        });

        function exportToPDF() {
            const element = document.querySelector('.publication-content');
            if (!element) {
                Swal.fire({
                    icon: 'error',
                    title: 'Export Failed',
                    text: 'Content not found'
                });
                return;
            }

            Swal.fire({
                title: 'Generating PDF',
                text: 'Please wait...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            const options = {
                margin: [10, 10],
                filename: 'publication.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().from(element).set(options).save()
                .then(() => {
                    Swal.fire({
                        icon: 'success',
                        title: 'PDF Generated Successfully!',
                        showConfirmButton: false,
                        timer: 1500
                    });
                });
        }

        function generatePDF() {
            // Show loading spinner
            Swal.fire({
                title: 'Generating PDF...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            // Get the content
            const content = document.querySelector('.publication-content');

            // Configure PDF options
            const opt = {
                margin: 1,
                filename: 'publication.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            };

            // Generate PDF
            html2pdf()
                .from(content)
                .set(opt)
                .save()
                .then(() => {
                    Swal.fire({
                        icon: 'success',
                        title: 'PDF Downloaded!',
                        showConfirmButton: false,
                        timer: 1500
                    });
                });
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

    </script>

</body>

</html>